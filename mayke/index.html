<html>

<head>
  <script src="mqtt.min.js" type="text/javascript"></script>
  <style>
  .boton_1 {
    display: inline-block;
    padding: 15px 25px;
    font-size: 34px;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    outline: none;
    color: #fff;
    background-color: #4CAF50;
    border: none;
    border-radius: 15px;
    box-shadow: 0 9px #899;
  }
  .boton_1:hover {background-color: #3e8e41}
  .boton_1:active {
    background-color: #3e8e41;
    box-shadow: 0 5px #664;
    transform: translateY(4px);
  }
  .boton_2 {
    display: inline-block;
    padding: 15px 42px;
    font-size: 34px;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    outline: none;
    color: #fff;
    background-color: #FB7281;
    border: none;
    border-radius: 15px;
    box-shadow: 0 9px #899;
  }
  .boton_2:hover {background-color: #EC132A}
  .boton_2:active {
    background-color: #EC132A;
    box-shadow: 0 5px #664;
    transform: translateY(4px);
  }
  </style>
</head>

<body>

  <center>
  <h1>SERVIDOR CASA</h1>
  <div>
  <button class="boton_1"  onclick="enviarDatoMQTTbt1();">Encender</button>
  <button class="boton_2"  onclick="enviarDatoMQTTbt2();">Apagar ya</button>
</div>
<div>
  <button class="boton_1"  onclick="enviarDatoMQTTbt3();">Encender</button>
  <button class="boton_2"  onclick="enviarDatoMQTTbt4();">Apagar ya</button>
</div>
  <svg width="100" height="75" viewBox= "0 0 640 480">
  <defs>
    <linearGradient id="svg_6" x1="0" y1="0" x2="1" y2="0">
     <stop stop-color="#bfbfbf" offset="0"/>
     <stop stop-color="#404040" offset="1"/>
    </linearGradient>
    <linearGradient id="svg_11" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
     <stop id="led1" stop-color="#000000" stop-opacity="0.992188" offset="0"/>
     <stop stop-color="#820101" stop-opacity="0.988281" offset="1"/>
    </linearGradient>
    <linearGradient id="svg_14" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
     <stop stop-color="#ffffff" stop-opacity="0.996094" offset="0"/>
     <stop stop-color="#d30606" stop-opacity="0.984375" offset="0.703125"/>
    </linearGradient>
   </defs>
   <g>
    <title>Layer 1</title>
    <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" cx="320" cy="240" r="196.125" id="svg_3" fill-opacity="0.77" transform="rotate(90, 320, 240)"/>
    <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" fill-opacity="0.64" cx="319.252837" cy="239.999045" r="160" id="svg_7"/>
    <circle fill="url(#svg_11)" stroke-width="17.5" stroke-linecap="round" cx="320.000535" cy="240.001698" r="150" id="svg_8"/>
    <ellipse fill="url(#svg_14)" stroke-width="17.5" stroke-linecap="round" cx="250.179609" cy="170.124194" rx="75.675959" ry="44.402987" id="svg_20" transform="rotate(-47.7626, 250.18, 170.125)"/>
   </g>
  </svg>
  </div>

  </center>
<script>
// connect options

topic_raiz           = "luces_FAMARPE"
topic_conexion       = "/conexion"
topic_variables      = "/datos_variables"
topic_accion_botones = "/181994/actions/"
topic_datos_lamparas = "/datos_lamparas"

// Mensajes
mensaje_inicial = "Desconectado"
resultado_1 = "1"
resultado_2 = "0"
const options = {
  connectTimeout: 4000,
  // Authentication
  clientId:  " FAMARPE_WEB --->> " + Math.floor((Math.random() * 1000000) + 1),
  username: 'mayke_iot',
  password: 'Mk121988181994',
  keepalive: 60,
  clean: true,
}
// WebSocket connect url
const WebSocket_URL = 'wss://broker.shiftr.io:443/mqtt'

// TCP/TLS connect url
//const TCP_URL = 'mqtt://broker.shiftr.io:443'
//const TCP_TLS_URL = 'mqtts://localhost:8883'

const client = mqtt.connect(WebSocket_URL, options)

client.on('connect', () => {
  console.log('Conexion Exitosa')
  client.subscribe(topic_raiz + topic_variables)
  client.subscribe(topic_raiz + topic_conexion)
  client.subscribe(topic_raiz + topic_datos_lamparas)

  client.publish(topic_raiz + topic_conexion,mensaje_inicial, (error) => {
    console.log(error || 'Publicacion Exitosa')
  })

})

client.on('reconnect', (error) => {
  console.log('Reconectado MQTT:', error)

  client.publish(topic_raiz + topic_conexion,mensaje_inicial, (error) => {
    console.log(error || 'Publicacion Exitosa')
  })

})

client.on('error', (error) => {
  console.log('Error de Conexion:', error)
})

// Recibir mensajes y verlos en el navegador
client.on('message', (topic, message) => {
  console.log('receive messageï¼š', topic, message.toString())

  if (topic == topic_raiz + "/datos_lamparas"){
    var splitted = message.toString().split(",");

    var lampara1 = splitted[0];
    var lampara2 = splitted[1];
    var lampara3 = splitted[2];
    var lampara4 = splitted[3];
    var lampara5 = splitted[4];
    var lampara6 = splitted[5];
    var lampara7 = splitted[6];
    var lampara8 = splitted[7];
    var lampara9 = splitted[8];
    var lampara10 = splitted[9];


    if(lampara1 == "1"){
      document.getElementById("led1").setAttribute("stop-color", "#550000");
      console.log('led uno encendido')
    }else{
      document.getElementById("led1").setAttribute("stop-color","#000000");
      console.log('led uno apagado')
    }
    if(lampara2 == "1" ){
      document.getElementById("led1").setAttribute("stop-color", "#550000");
      console.log('led dos encendido')
    }else{
      document.getElementById("led1").setAttribute("stop-color", "#550000");
      console.log('led dos encendido')
    }
    if(lampara3 == "1" ){

    }else{

    }
    if(lampara4 == "1" ){

    }else{

    }
    if(lampara5 == "1" ){

    }else{

    }
    if(lampara6 == "1" ){

    }else{

    }
    if(lampara7 == "1" ){

    }else{

    }
    if(lampara8 == "1" ){

    }else{

    }
    if(lampara9 == "1" ){

    }else{

    }
    if(lampara10 == "1" ){

    }else{

    }
  }

})


// funcion de botones
function enviarDatoMQTTbt1() {
  client.publish(topic_raiz + topic_accion_botones + "sw1",resultado_1, (error) => {
    console.log(error || 'Publicacion Exitosa')
  })
}
function enviarDatoMQTTbt2() {
  client.publish(topic_raiz + topic_accion_botones + "sw1",resultado_2, (error) => {
    console.log(error || 'Publicacion Exitosa')
  })
}
// funcion de botones
function enviarDatoMQTTbt3() {
  client.publish(topic_raiz + topic_accion_botones + "sw2",resultado_1, (error) => {
    console.log(error || 'Publicacion Exitosa')
  })
}
function enviarDatoMQTTbt4() {
  client.publish(topic_raiz + topic_accion_botones + "sw2",resultado_2, (error) => {
    console.log(error || 'Publicacion Exitosa')
  })
}

</script>


</body>

</html>
